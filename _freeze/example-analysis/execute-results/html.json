{
  "hash": "0c97a272a2b50a6fdf9ce688d36f8bb6",
  "result": {
    "markdown": "---\ntitle: \"Example analysis\"\nbibliography: references.bib\n---\n\n\n# Background\n\n## Research Question\n\nWhat is the level of agreement of the two definitions of pre-term birth, i.e. weight at birth \\< 2,500 grams and weeks of gestation at birth \\<37 weeks?\n\n## Intended Audience\n\nResearchers who may be deciding to choose only one measure over the other to measure preterm birth when there are not enough study resources to do both\n\nWeeks of gestation is much easier to measure as no other equipment is required unlike birth weight, but may be prone to recall bias if no medical records are available to check. Measuring birth weight is more objective as a scale can be used, but this scale may require more resources, such as procuring the scales across study sites and training research staff follow a standard protocol.\n\n## Data Description\n\nWe used the publicly available data set from Micalowicz *et al* (2006) published in the *New England Journal of Medicine* [@michalowicz2006], which was a multi-center randomized trial that examined whether timing of periodontal disease treatment (treatment: prior to 21 weeks gestation, control: after delivery) affects the likelihood of pre-term birth, defined as less than 37 weeks gestational age.\n\nThis is a longitudinal data set of 823 women who were 13-16 weeks gestational age at randomization, followed by five monthly visits. There are 171 variables corresponding to the exposure, outcome, and covariates collected throughout the entire study period.\n\nThe data set is currently set up in wide format, meaning each row represents one study participant, and the covariates and outcome data collected at follow-up visits are set up as separate columns. Full details on the data set, as well as the complete data dictionary are available [here](https://www.causeweb.org/tshs/obstetrics-and-periodontal-therapy/).\n\nThe data set is available on the Comprehensive R Archive Network (CRAN) as part of the `medicaldata` package, stored as the `opt` data frame once the package is loaded in library. The variables of interest are:\n\n-   `PID`: Patient unique identifier (ID)\n-   `GA.at.outcome`: Gestational age in days\n-   `Birthweight`: Birth weight in grams\n-   `Birth.outcome`: Outcome of pregnancy with four levels\n    -   Elective abortion\n    -   Live birth\n    -   Lost of FU (follow-up)\n    -   Non-live birth (i.e., stillbirth or spontaneous abortion)\n\n:::{.callout-warning}\nThe factor values have lagging spaces in the end, so we need to add an additional data processing step using the `str_trim` function from the `stringr` package (part of `tidyverse`) and replace the affected columns using `mutate`.\n:::\n\n## Analysis\n\nWe examined a simple relationship between two continuous variables: gestational age at the end of pregnancy (in days) and birth weight at time of delivery (in grams). We expect that generally, there is a positive association between gestational age and birth weight as these are two related measures for pre-term birth [@oken2003]. \n\nPre-term births are sometimes defined by gestational age (a typical cutoff is 37 weeks), or by weight (a typical cutoff is 2500 grams). \n\n\n:::{.column-margin}\nThe positive percent agreement is:\n\n\n$$\\frac{A}{A+B+C}$$\n\nThe Kappa statistic is:\n\n\n$$\\frac{P(\\mathrm{observed}) - P(\\mathrm{expected})}{1 - P(\\mathrm{expected})}$$\n\n\nwhere $P(\\mathrm{observed}) = \\frac{A+D}{A+B+C+D}$, $P(\\mathrm{expected}) = \\frac{(A+C)(A+B) + (B+D)(C+D)}{(A+B+C+D)^2}$\n:::\n\nGiven the following 2 x 2 table:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable <- data.frame(c(\"A\", \"B\"), c(\"C\", \"D\"))\nrownames(table) <- c(\"< 2,500 g\", \">= 2,500 g\")\ncolnames(table) <- c(\"< 37 weeks\", \">= 37 weeks\")\n\nknitr::kable(table, type = \"html\") |>\n  kableExtra::add_header_above(c(\"Birthweight\", \"Gestational age\" = 2))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n<tr>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"1\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Birthweight</div></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"2\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Gestational age</div></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:left;\"> &lt; 37 weeks </th>\n   <th style=\"text-align:left;\"> &gt;= 37 weeks </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> &lt; 2,500 g </td>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> C </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> &gt;= 2,500 g </td>\n   <td style=\"text-align:left;\"> B </td>\n   <td style=\"text-align:left;\"> D </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nWe want to examine, visually, the level of agreement between these two definitions. We also want to calculate some agreement statistics, such as positive percent agreement and kappa statistic [@xia2020]. The formula for both statistics are found on the side.\n\nInterpreting the kappa statistic, we use the following guide:\n\n![](https://www.researchgate.net/publication/283871290/figure/tbl2/AS:667815476461571@1536231025215/Kappa-statistic-classification.png)\n\n\n\n# Data Preparation\n\nWe restricted the data to women whose pregnancies resulted to live births and were observed within the study period. The final sample size is 793 women.\n\nWe also created two new binary variables: `premature` for gestational age < 37 and `lbw` for birthweight < 2,500 g. We also created a new variable called `discord` that indicates whether observations are concordant or discordant based on the two definitions in aid of visualizing them later on our figures.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(medicaldata)\n# The data set is stored in opt, then we call it into the environment\nopt <- opt\n\nlibrary(tidyverse)\n# Select the variables needed for the analysis\n  # PID = patient ID\n  # GA.at.outcome = gestational age in days\n  # Birthweight = birth weight in g\n# Restrict data to live births only (Birth.outcome == \"Live birth\")\n# But clean factor values first using str_trim and apply changes using mutate\n# Then create premature, lbw, and concordant variables\ndata <- opt |> mutate(across(where(is.factor), str_trim)) |> \n  filter(Birth.outcome == \"Live birth\") |>\n  select(PID, GA.at.outcome, Birthweight) |>\n  mutate(premature = ifelse(GA.at.outcome < 37*7, 1, 0),\n         lbw = ifelse(Birthweight < 2500, 1, 0),\n         discord = ifelse(premature == lbw, 0, 1)) |>\n  mutate(premature = factor(premature, levels = c(0, 1), \n                            labels = c(\"Gestational age >= 37 weeks\", \n                            \"Gestational age < 37 weeks\")),\n         lbw = factor(lbw, levels = c(0,1),\n                      labels = c(\"Birthweight >= 2,500 g\", \"Birthweight < 2,500 g\")),\n         discord = factor(discord, levels = c(0,1),\n                          labels = c(\"Concordant\", \"Discordant\")))\nhead(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     PID GA.at.outcome Birthweight                   premature\n1 100034           265        3490 Gestational age >= 37 weeks\n2 100042           253        2350  Gestational age < 37 weeks\n3 100067           266        2525 Gestational age >= 37 weeks\n4 100083           271        3650 Gestational age >= 37 weeks\n5 100091           280        3865 Gestational age >= 37 weeks\n6 100109           275        3120 Gestational age >= 37 weeks\n                     lbw    discord\n1 Birthweight >= 2,500 g Concordant\n2  Birthweight < 2,500 g Concordant\n3 Birthweight >= 2,500 g Concordant\n4 Birthweight >= 2,500 g Concordant\n5 Birthweight >= 2,500 g Concordant\n6 Birthweight >= 2,500 g Concordant\n```\n:::\n:::\n\n\nWe also define a custom theme for the figures:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncustom_theme <- theme(\n  panel.background = element_blank(),\n  axis.ticks = element_blank(),\n  axis.text = element_text(size = 12),\n  axis.title = element_text(size = 12, face = \"bold\"),\n  axis.line = element_line(linewidth = 0.5),\n  plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5),\n  plot.subtitle = element_text(size = 14, face = \"bold\", hjust = 0.5),\n  strip.text.x = element_text(size = 12, face = \"bold\")\n)\n```\n:::\n\n\n# Results\n\n## Exploratory Data Analysis\n\nFirst, we show a histogram of the values of gestational age (`GA.at.outcome`) by low birth weight (`lbw`) status, as shown in @fig-hist1:\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nggplot(data = data, aes(x = GA.at.outcome)) +\n  geom_histogram() +\n  scale_x_continuous(limits = c(147, 315), \n                     breaks = seq(147, 315, 28),\n                     labels = seq(147, 315, 28)/7) +\n  geom_vline(xintercept = 37*7, linetype = \"dashed\", color = \"gray\") +\n  facet_grid(cols = vars(lbw)) +\n  labs(x = \"Gestational age at birth (in weeks)\",\n       title = \"Histogram of gestational age (in weeks)\",\n       subtitle = \"stratified by low birth weight status\",\n       y = \"Number of births\",\n       caption = \"Dotted vertical line indicates cutoff for premature birth (37 weeks)\") +\n  custom_theme\n```\n\n::: {.cell-output-display}\n![Histogram of gestational age (in weeks) by low birth weight status](example-analysis_files/figure-html/fig-hist1-1.png){#fig-hist1 width=672}\n:::\n:::\n\n\nSimilarly, we show a histogram of the values of birth weight (`Birthweight`) by premature (`premature`) status, as shown in @fig-hist2:\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nggplot(data = data, aes(x = Birthweight)) +\n  geom_histogram() +\n  scale_y_continuous(breaks = seq(0, 5000, 500),\n                     labels = function(x) format(x, big.mark = \",\")) +\n  geom_vline(xintercept = 2500, linetype = \"dashed\", color = \"gray\") +\n  facet_grid(cols = vars(premature)) +\n  labs(x = \"Birth weight (in grams)\",\n       title = \"Histogram of birth weight (in grams)\",\n       subtitle = \"stratified by premature status\",\n       y = \"Number of births\",\n       caption = \"Dotted vertical line indicates cutoff for birth weight (2,500 weeks)\") +\n  custom_theme\n```\n\n::: {.cell-output-display}\n![Histogram of birth weight (in grams) by premature status](example-analysis_files/figure-html/fig-hist2-1.png){#fig-hist2 width=672}\n:::\n:::\n\n\nWe then bring both variables together in a scatterplot as shown in @fig-scatter:\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nggplot(data = data, aes(x = GA.at.outcome, y = Birthweight)) +\n  geom_jitter(aes(color = discord), size = 1) + \n  scale_x_continuous(limits = c(147, 315), \n                     breaks = seq(147, 315, 28),\n                     labels = seq(147, 315, 28)/7) +\n  scale_y_continuous(breaks = seq(0, 5000, 500),\n                     labels = function(x) format(x, big.mark = \",\")) +\n  scale_color_manual(breaks = c(\"Concordant\", \"Discordant\"),\n                     values = c(\"darkgray\", \"#920045\")) +\n  labs(x = \"Gestational age at birth (in weeks)\",\n       y = \"Birth weight at birth (in grams)\",\n       title = \"Scatterplot of gestational age (in weeks) and birth weight (in grams)\",\n       subtitle = \"colored by concordance of definitions of pre-term birth\") +\n  geom_hline(yintercept = 2500, linetype = \"dashed\", size = 0.75) +\n  geom_vline(xintercept = 37*7, linetype = \"dashed\", size = 0.75) + \n  annotate(\"text\", x = 27*7, y = 3000, hjust = 0, color = \"#920045\",\n           label = \"Pre-term according to \\n gestational age only\") +\n  annotate(\"text\", x = 40*7, y = 1500, hjust = 0, color = \"#920045\",\n           label = \"Pre-term according to \\n birth weight only\") +\n  custom_theme +\n  # Add the legend position and title font settings\n  theme(legend.position = c(0.1, 0.9),\n        legend.title = element_blank(),\n        legend.key = element_blank(),\n        legend.text = element_text(size = 11),\n        plot.title = element_text(size = 14, face = \"bold\", hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![Scatterplot of gestational age (in weeks) and birth weight (in grams) colored by concordance of definitions of pre-term birth](example-analysis_files/figure-html/fig-scatter-1.png){#fig-scatter width=672}\n:::\n:::\n\n\n## Agreement Statistics\n\nWe summarize the 2x2 table as follows:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable <- data |> group_by(premature, lbw) |> tally() |> spread(premature, n) \ntable |>\n  knitr::kable(type = \"html\", col.names = c(\"\", \"<37 weeks\", \">= 37 weeks\")) |>\n  kableExtra::add_header_above(c(\"\", \"Gestational age\" = 2))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"2\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Gestational age</div></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\">  </th>\n   <th style=\"text-align:right;\"> &lt;37 weeks </th>\n   <th style=\"text-align:right;\"> &gt;= 37 weeks </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Birthweight &gt;= 2,500 g </td>\n   <td style=\"text-align:right;\"> 693 </td>\n   <td style=\"text-align:right;\"> 32 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Birthweight &lt; 2,500 g </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 50 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nTherefore, the positive percent agreement is:\n\nThe positive percent agreement is:\n\n\n$$\\frac{A}{A+B+C} = \\frac{693}{693+18+32} = 0.9327%$$\n\n\nCalculating the Kappa Statistic:\n\n\n$$P(\\mathrm{observed}) = \\frac{A+D}{A+B+C+D} = \\frac{693 + 50}{693 + 18 + 32 + 50} = 0.9369$$\n\n$$P(\\mathrm{expected}) = \\frac{(A+C)(A+B) + (B+D)(C+D)}{(A+B+C+D)^2} = \\frac{(693 + 32)(693 + 18) + (18 + 50)(32 + 50)}{(693 + 18 + 32 + 50)^2} = 0.8286$$\n\n$$\\kappa = \\frac{P(\\mathrm{observed}) - P(\\mathrm{expected})}{1 - P(\\mathrm{expected})} = \\frac{0.9369 - 0.8286}{1 - 0.8286} = 0.632$$\n\n\n# Summary\n\n:::{.callout-note}\n**Key message**: There is a fairly high level of agreement between birth weight and gestational age in defining pre-term birth. Either measure to define pre-term birth should be fine.\n:::\n\nUsing baseline data from a clinical trial of 793 women on periodontal disease and preterm birth, this analysis looked at the agreement between two measures of preterm birth: birth weight less than 2,500 g and gestational age at 37 weeks. Exploratory data analysis was done using histograms of the continuous measure of one definition stratified by the binary definition of the other, as well as a scatterplot of both continuous measures. Percent positive agreement and Kappa statistics were used to quantify the agreement. Results show a 93.7% percent positive agreement and kappa statistic of 0.63, indicating a fairly high level of agreement. Therefore, either measure to define pre-term birth may be used in future related research studies.\n\n\n# List of functions used\n\n* `dplyr`: `filter()`, `mutate()`, `select()`, `group_by()`, `tally()`\n* `tidyr`: `spread()`\n* `ggplot2`: `geom_histogram()`, `geom_vline()`, `geom_jitter`, `geom_hline`\n\n## References\n\n::: {#refs}\n:::\n",
    "supporting": [
      "example-analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}